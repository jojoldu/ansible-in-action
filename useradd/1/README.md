# 1. 앤서블 설치 및 호스트 서버들 연결하기


## 1-1. 환경 소개

* AWS의 EC2 3대로 진행합니다.
  * Amazon Linux 1을 사용합니다.
    * Centos 6 버전 설치하시면 됩니다.
    * 현재 팀내 IDC 인프라가 Centos6 이라서 그에 맞춰 진행합니다.
  * EC2 1대는 앤서블의 서버로
  * 나머지 2대는 앤서블의 호스트로
* 도커, VMWare 등 다른 가상 컨테이너들을 사용해 구성해도 무방합니다.
* 앤서블 서버 -> 호스트로는 접근이 되어야 합니다.

뭐가 됐든 3대의 서버만 있으시면 됩니다.

## 1-2. 왜 앤서블?

이미 잘 운영되고 있는 서버들에 **동일한 명령어를 수행해야 할 때가 있습니다**.

* 신규 입사자를 위한 서버 계정 생성
  * 클라우드에서는 ec2-user로 다 통일해서 쓰는 경우가 있는데 IDC 정책상 개발자마다 서버 계정 발급 받아 써야하는 경우가 많습니다.
* 기존 사용자의 비밀번호 변경
* 기존 사용자의 Sudo 권한 제거

등등 흔히 말하는 **짜치는 업무**들이 생각보다 자주 필요합니다.  
이런 일이 수십대, 수백대 서버에 필요하다고 하면 그날부터 노가다 시작입니다.  

이걸 해결하기 위해 쉘 스크립트를 이용해 전체 서버에 명령을 수행하기도 합니다.  
  
다만, 이렇게 되면 쉘 스크립트를 잘 모르시는 분들껜 하나의 허들이 될 수 있고, **작성한 사람만 수정할 경우가 많습니다**.  
  
**전체 서버에 동일한 명령어**를 안정적으로 수행하고 **이력 관리**가 되는게 필요하면 도구의 힘을 빌리는게 편합니다.  
  
이런 도구를 Infrastructure as Code 라고 부르며 앤서블과 더불어 Puppet, Chef, Salt 등이 있습니다.  
이 중에서 앤서블을 선택한 이유는 다음과 같습니다.

* 에이전트 설치가 필요 없습니다.
  * Puppet, Chef는 각 호스트에 에이전트가 꼭 설치되어있어야 합니다.
  * Salt는 선택 사항입니다.
* 문법이 YAML 이라 익히기 쉽습니다.
  * 다른 도구들의 경우 자체 DSL을 사용하는데 앤서블의 경우 DSL을 쓰지 않고 YAML로만 사용 합니다.
  * 그만큼 러닝 커브 (학습 곡선)이 낮습니다. (시간 투자 대비 얻는 지식이 많습니다.)
* 국내 자료가 가장 많습니다.
  * 서점에 가서 검색해보시면 다른 기술들에 비해 앤서블 책이 압도적으로 많습니다.

이런 이유로 앤서블을 선택했습니다.  

자 그럼 앤서블 실습을 시작해보겠습니다.

## 1-3. 앤서블 설치

앤서블 서버 (호스트에 명령을 주는 서버)로 접속하셔서 앤서블을 설치합니다.  
  
EC2 서버에 접속하시면 기본 계정이 ec2-user이기 때문에 먼저 root 계정으로 변경합니다.

```bash
sudo su - root
```

여기서는 yum을 통해 설치하지 않고 ```pip```를 통해 설치하겠습니다.  
리눅스에서는 기본적으로 파이선2와 ```pip```가 설치되어 있으니 pip로 설치합니다.

```bash
pip install ansible
```

yum 설치가 아닌 pip로 설치한 이유는 다음과 같습니다.

* 어떤 OS환경에서도 같은 방식으로 가능합니다.
* 모듈에 따라 필요한 의존 패키지들 설치가 편합니다.
* **개발 버전**도 설치 가능합니다.

apt-get, yum, exe 설치 등 관계 없이 일관된 방법으로 설치가 가능하니 ```pip```로 설치해서 진행하시면 편합니다.  
  
설치가 다 되셨다면 간단한 명령어로 확인합니다.

```bash
ansible -h
```

![1](./images/1.png)

여기까지 확인되셨다면 설치가 성공적으로 되신겁니다.

## 1-4. 호스트 등록

먼저 명령어를 수행할 호스트 서버들을 등록합니다.  
  
```bash
vim /etc/ansible/hosts
```

